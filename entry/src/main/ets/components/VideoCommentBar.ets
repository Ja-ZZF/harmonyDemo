import { CommentSimple } from "../models/Comment"
import { createEmptyPostDetail, PostDetail, PostSimple } from "../models/Post"
import { CommentDialog } from "./Dialog/CommentDialog"
import { PostCommentNew } from "./PostCommentNew"

//è§†é¢‘çš„è¯„è®ºåŒº
@Component
export struct VideoCommentBar{
  @Prop post : PostDetail = createEmptyPostDetail()

  commentDialogController : CustomDialogController = new CustomDialogController({
    builder : CommentDialog({
      postId : this.post.post_simple.post_id,
      parentCommentId : null,
    }),
    alignment : DialogAlignment.Bottom,
  })

  build() {
    Column(){
      Text(this.post.comment_count.toString()+'æ¡è¯„è®º')
        .fontSize(12)
        .padding({top:8,bottom:8})

      //è¾“å…¥è¯„è®º
      Row()
      {
        Text('è¯´ç‚¹ä»€ä¹ˆâ€¦')
          .fontSize(14)
          .fontColor(Color.Gray)
      }
      .width('100%')
      .height(36)
      .backgroundColor(0xFFF0F0F0)
      .borderRadius(18)
      .alignItems(VerticalAlign.Center)
      .padding({ left: 12 })
      .onClick(() => {
        console.info('ç‚¹å‡»äº†è¯´ç‚¹ä»€ä¹ˆ');
        this.commentDialogController.open()
      })

      //è¯„è®ºåŒº
      Scroll() {
        Column() {
          ForEach(this.post.comments, (comment: CommentSimple) => {
            PostCommentNew({ comment: comment })
          }, (comment: CommentSimple) => comment.comment_id.toString())
        }
      }
      .padding({bottom:60,left: 8, right: 8,}) // ç•™å‡ºåº•éƒ¨æ é«˜åº¦
      .flexGrow(1) // ğŸ’¡ å…³é”®

    }
    .width('100%')
    .height('55%')
    .borderRadius(8)
    .margin({top:'85%'})
    .backgroundColor(Color.White)
    .align(Alignment.Bottom)
    .transition({//å…¥åœºåŠ¨ç”»
      type: TransitionType.Insert,
      opacity: 1,
      translate: {
        y: '100%'
      }
    })
    .transition({//ç¦»åœºåŠ¨ç”»
      type: TransitionType.Delete,
      opacity: 0,
      translate: {
        y: '100%'
      }
    })
  }
}